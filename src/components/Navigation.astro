---
const currentPath = Astro.url.pathname;
---

<nav
  class="navbar navbar-expand-lg navbar-dark fixed-top"
  style="background-color: rgba(0, 0, 0, 0.9); backdrop-filter: blur(10px); border-bottom: 2px solid var(--rhps-gold);"
>
  <div class="container">
    <!-- Logo -->
    <a class="navbar-brand font-malicious-moonlight text-rhps-gold" href="/">
      RHPS on the Palouse
    </a>

    <!-- Mobile Menu Button -->
    <button
      class="navbar-toggler"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#navbarNav"
      aria-controls="navbarNav"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Navigation Links -->
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav mx-auto">
        <li class="nav-item">
          <a class="nav-link text-white" href="#hero">Home</a>
        </li>
        <!-- <li class="nav-item">
          <a class="nav-link text-white" href="#tickets">Tickets</a>
        </li> -->
        <li class="nav-item">
          <a class="nav-link text-white" href="#faq">FAQ</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white" href="#about">About</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white" href="#location">Location</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white" href="#" id="contact-link">Contact</a>
        </li>
      </ul>

      <!-- CTA Button -->
      <a
        class="btn btn-warning fw-bold ms-auto"
        href="#tickets"
        style="background-color: var(--rhps-gold); border-color: var(--rhps-gold); color: black;"
      >
        Buy Tickets
      </a>
    </div>
  </div>
</nav>

<script>
  // Smooth scrolling for anchor links
  document.addEventListener("DOMContentLoaded", () => {
    const links = document.querySelectorAll('a[href^="#"]');

    links.forEach((link) => {
      link.addEventListener("click", (e) => {
        const href = link.getAttribute("href");
        if (href && href.startsWith("#")) {
          const target = document.querySelector(href);
          if (target) {
            e.preventDefault();
            target.scrollIntoView({
              behavior: "smooth",
              block: "start",
            });

            // Close mobile menu if open (Bootstrap collapse)
            const navbarCollapse = document.getElementById("navbarNav");
            if (navbarCollapse && navbarCollapse.classList.contains("show")) {
              // Use Bootstrap's collapse method if available
              if (typeof window !== "undefined" && (window as any).bootstrap) {
                const bsCollapse = new (window as any).bootstrap.Collapse(
                  navbarCollapse,
                  {
                    toggle: false,
                  }
                );
                bsCollapse.hide();
              } else {
                // Fallback: manually hide the menu
                navbarCollapse.classList.remove("show");
              }
            }
          }
        }
      });
    });

    // Handle Contact link click to open Crisp chat
    const contactLink = document.getElementById("contact-link");
    if (contactLink) {
      contactLink.addEventListener("click", (e) => {
        e.preventDefault();

        // Open Crisp chat
        if (typeof window !== "undefined" && (window as any).$crisp) {
          (window as any).$crisp.push(["do", "chat:open"]);
        }

        // Close mobile menu if open
        const navbarCollapse = document.getElementById("navbarNav");
        if (navbarCollapse && navbarCollapse.classList.contains("show")) {
          if (typeof window !== "undefined" && (window as any).bootstrap) {
            const bsCollapse = new (window as any).bootstrap.Collapse(
              navbarCollapse,
              {
                toggle: false,
              }
            );
            bsCollapse.hide();
          } else {
            navbarCollapse.classList.remove("show");
          }
        }
      });
    }
  });
</script>
